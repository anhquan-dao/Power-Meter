Version 4
SHEET 1 2228 1572
WIRE 944 -192 864 -192
WIRE 1168 -192 944 -192
WIRE 944 -176 944 -192
WIRE -144 -128 -176 -128
WIRE 48 -128 -48 -128
WIRE 224 -128 192 -128
WIRE 336 -128 320 -128
WIRE 1168 -128 1168 -192
WIRE 944 -80 944 -96
WIRE 1104 -80 944 -80
WIRE 944 0 944 -80
WIRE 976 0 944 0
WIRE 1072 0 1040 0
WIRE 1168 0 1168 -32
WIRE 1168 0 1152 0
WIRE 1280 0 1168 0
WIRE 944 16 944 0
WIRE 784 64 736 64
WIRE 880 64 864 64
WIRE -176 80 -176 -128
WIRE -176 80 -288 80
WIRE -144 80 -176 80
WIRE 48 80 48 -128
WIRE 48 80 -48 80
WIRE 112 80 48 80
WIRE 192 80 192 -128
WIRE 192 80 112 80
WIRE 224 80 192 80
WIRE 336 80 336 -128
WIRE 336 80 320 80
WIRE 400 80 336 80
WIRE 528 80 400 80
WIRE 192 96 192 80
WIRE 48 112 48 80
WIRE -288 128 -288 80
WIRE 528 128 528 80
WIRE 192 176 192 160
WIRE 272 176 272 160
WIRE 272 176 192 176
WIRE 944 176 944 112
WIRE 272 208 272 176
WIRE -96 224 -96 160
WIRE 48 224 48 176
WIRE 48 224 -96 224
WIRE 272 240 272 208
WIRE -96 256 -96 224
WIRE 896 272 800 272
WIRE 976 272 896 272
WIRE 1088 272 976 272
WIRE 976 320 976 272
WIRE -1072 384 -1168 384
WIRE -960 384 -1072 384
WIRE -800 384 -864 384
WIRE -464 384 -544 384
WIRE -1072 400 -1072 384
WIRE 704 400 672 400
WIRE 800 400 800 352
WIRE 800 400 784 400
WIRE 1568 400 1312 400
WIRE 1680 400 1568 400
WIRE 1904 400 1680 400
WIRE -1168 416 -1168 384
WIRE 672 416 672 400
WIRE -288 432 -288 208
WIRE -96 432 -96 336
WIRE -96 432 -288 432
WIRE 448 432 448 192
WIRE 448 432 -96 432
WIRE 528 432 528 208
WIRE 528 432 448 432
WIRE 896 448 896 272
WIRE 1312 448 1312 400
WIRE 1904 448 1904 400
WIRE -288 464 -288 432
WIRE 800 464 800 400
WIRE 864 464 800 464
WIRE 1680 464 1680 400
WIRE -912 480 -912 464
WIRE -912 480 -1072 480
WIRE 976 480 976 400
WIRE 976 480 928 480
WIRE 1088 480 976 480
WIRE 768 496 752 496
WIRE 832 496 768 496
WIRE 864 496 832 496
WIRE -1072 512 -1072 480
WIRE 832 528 832 496
WIRE -1168 544 -1168 496
WIRE -1104 544 -1168 544
WIRE 256 544 160 544
WIRE 320 544 256 544
WIRE 1904 544 1904 528
WIRE 1968 544 1904 544
WIRE 1904 560 1904 544
WIRE -1168 576 -1168 544
WIRE 688 576 608 576
WIRE 768 576 768 496
WIRE 768 576 752 576
WIRE 1568 576 1568 400
WIRE 256 592 256 544
WIRE 1200 592 1136 592
WIRE 1312 592 1312 528
WIRE 1312 592 1264 592
WIRE 1536 592 1312 592
WIRE -160 608 -176 608
WIRE 48 608 -80 608
WIRE 224 608 48 608
WIRE 1312 608 1312 592
WIRE 1680 608 1680 544
WIRE 1680 608 1600 608
WIRE 1728 608 1680 608
WIRE 1744 608 1728 608
WIRE 1840 608 1824 608
WIRE 48 624 48 608
WIRE 320 624 288 624
WIRE 432 624 320 624
WIRE 896 624 896 512
WIRE 1488 624 1440 624
WIRE 1536 624 1488 624
WIRE -480 640 -480 624
WIRE 224 640 192 640
WIRE 832 640 832 608
WIRE 1440 640 1440 624
WIRE 688 656 608 656
WIRE 768 656 768 576
WIRE 768 656 752 656
WIRE -480 672 -480 640
WIRE 1488 672 1488 624
WIRE 1584 672 1488 672
WIRE 1664 672 1648 672
WIRE 1728 672 1728 608
WIRE -1168 704 -1168 656
WIRE -1072 704 -1072 576
WIRE -1072 704 -1168 704
WIRE -912 704 -1072 704
WIRE -672 704 -672 480
WIRE -672 704 -912 704
WIRE 1904 704 1904 656
WIRE -64 752 -64 704
WIRE 48 752 48 704
WIRE 48 752 -64 752
WIRE 256 752 256 656
WIRE 256 752 48 752
WIRE 1136 752 1136 672
WIRE 1312 752 1312 688
WIRE 1312 752 1136 752
WIRE 1488 752 1312 752
WIRE 1568 752 1568 640
WIRE 1568 752 1488 752
WIRE -912 768 -912 704
WIRE 256 784 256 752
WIRE 1440 784 1440 704
WIRE 1136 800 1136 752
WIRE -480 864 -480 752
WIRE 1440 928 1440 864
FLAG -288 464 0
FLAG 400 80 out
FLAG 272 208 gate
FLAG -288 80 Vin
FLAG 112 80 Vpos
FLAG -480 864 0
FLAG -480 640 1_2ref
FLAG 192 640 1_2ref
FLAG -176 608 Vpos
FLAG 432 624 OVLO
FLAG 160 544 5V
FLAG 256 784 0
FLAG 944 176 0
FLAG 864 -192 Vpos
FLAG 1280 0 gate
FLAG 272 -208 gate
FLAG -96 224 reverse_gate
FLAG -96 -208 reverse_gate
FLAG 896 624 0
FLAG 672 416 0
FLAG 832 640 5V
FLAG 736 64 gate_ctrl
FLAG 608 576 OVLO
FLAG 608 656 OCP
FLAG 1088 272 5V
FLAG 1088 480 gate_ctrl
FLAG -912 768 0
FLAG -464 384 5V
FLAG -1168 384 Vpos
FLAG 1136 800 0
FLAG 1312 400 5V
FLAG 1440 928 0
FLAG 1904 704 0
FLAG 1968 544 OCP
SYMBOL voltage -288 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 30 102 Right 2
SYMATTR Value PULSE(5 24 0 1u 1u 200m 500m 2)
SYMATTR InstName V1
SYMBOL res 512 112 R0
WINDOW 3 49 75 VRight 2
SYMATTR Value 9
SYMATTR InstName R_load
SYMBOL zener 208 160 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value EDZV18B
SYMBOL cap 432 128 R0
SYMATTR InstName C1
SYMATTR Value 100µF
SYMBOL res -112 240 R0
SYMATTR InstName R1
SYMATTR Value 50
SYMBOL zener 64 176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value EDZV18B
SYMBOL voltage -480 656 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName 1_2ref
SYMATTR Value 1.2
SYMBOL ZZZ\\Comparator\\lm393 256 624 R0
SYMATTR InstName U4
SYMBOL res -64 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 27k
SYMBOL res 64 720 R180
WINDOW 0 -35 67 Left 2
WINDOW 3 -34 31 Left 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 304 528 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL cap -80 640 R0
SYMATTR InstName C3
SYMATTR Value 1µF
SYMBOL npn 880 16 R0
SYMATTR InstName Q1
SYMATTR Value 2N2222
SYMBOL res 880 80 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R_gate2
SYMATTR Value 1k
SYMBOL res 928 -192 R0
SYMATTR InstName R2
SYMATTR Value 3k3
SYMBOL npn 1104 -128 R0
SYMATTR InstName Q2
SYMATTR Value 2N2222
SYMBOL schottky 1040 -16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMBOL ZZZ\\MOS\\IRF\\PMOSFET\\irf4905 -96 80 M270
WINDOW 0 82 37 VLeft 2
WINDOW 3 49 36 VLeft 2
SYMATTR InstName U1
SYMBOL ZZZ\\MOS\\IRF\\PMOSFET\\irf4905 272 80 R270
WINDOW 0 84 -41 VRight 2
WINDOW 3 48 -38 VRight 2
SYMATTR InstName U2
SYMBOL res 1168 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL ZZZ\\MOS\\IRF\\PMOSFET\\irf4905 272 -128 M90
WINDOW 0 84 -41 VRight 2
WINDOW 3 48 -38 VRight 2
SYMATTR InstName U9
SYMBOL ZZZ\\MOS\\IRF\\PMOSFET\\irf4905 -96 -128 R90
WINDOW 0 82 37 VLeft 2
WINDOW 3 49 36 VLeft 2
SYMATTR InstName U10
SYMBOL ZZZ\\Comparator\\lm393 896 480 R0
SYMATTR InstName U11
SYMBOL res 816 512 R0
SYMATTR InstName R19
SYMATTR Value 10k
SYMBOL res 784 256 R0
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res 800 384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 10k
SYMBOL schottky 752 560 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMATTR Value 1N5817
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 752 640 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D7
SYMATTR Value 1N5817
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 960 304 R0
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL voltage 1136 576 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -217 116 Left 2
SYMATTR Value PULSE(0 5 0 1u 1u 10m 160m 2)
SYMATTR InstName RESET
SYMBOL ZZZ\\REF\\TL431 -1088 512 R0
SYMATTR InstName U3
SYMBOL ZZZ\\VolReg\\7805 -672 384 R0
SYMATTR InstName U5
SYMBOL ZZZ\\MOS\\IRF\\PMOSFET\\irf4905 -912 384 R270
SYMATTR InstName U7
SYMBOL res -1088 384 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res -1184 400 R0
SYMATTR InstName R4
SYMATTR Value 3k3
SYMBOL res -1184 560 R0
SYMATTR InstName R5
SYMATTR Value 1k1
SYMBOL ZZZ\\Comparator\\lm393 1568 608 R0
SYMATTR InstName U6
SYMBOL diode 1200 608 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL res 1296 432 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL res 1296 592 R0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL diode 1456 704 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL voltage 1440 768 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 16 97 Left 2
SYMATTR Value PULSE(0 5 100m 1u 1u 5m)
SYMATTR InstName ALE
SYMBOL diode 1648 656 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D10
SYMATTR Value 1N4148
SYMBOL diode 1728 656 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D11
SYMATTR Value 1N4148
SYMBOL res 1472 656 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 1664 448 R0
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL npn 1840 560 R0
SYMATTR InstName Q3
SYMBOL res 1888 432 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL res 1840 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 6k8
TEXT -624 56 Left 2 !.tran 0 800m 0 1m startup
TEXT -192 -448 Left 2 !.param V_in=30
TEXT -192 -416 Left 2 !.param R_L = (V_in^2)/100
TEXT 1408 1088 Left 2 !.Model SW_1 SW(Ron=10m Roff=100Meg Vt=3)
